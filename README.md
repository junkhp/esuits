# [ESUITS](https://github.com/jphacks/D_2014)のデータベースを設計し直してアプリケーションを修正
以前ハッカソンで作成したエントリシート作成支援アプリケーションを作成したが，時間もなくデータベースの設計が割と適当だったのであらためて設計し直して適用．

ESUITSデプロイ先 →
https://esuits.herokuapp.com/

 # モデルの再設計
 ![データベースER図](https://github.com/junkhp/esuits_db_check/blob/main/esuits_db_er.png "ESUITSのデータベースのER図")

ポイント
- ユーザーとタグを多対多にした．(以前は一対多)
- エントリーシートのテーブルから企業テーブルと企業URLテーブルを分離

# アプリケーションそのものの修正
モデルの設計は完了したが，それに伴いアプリそのものを修正しないといけないので修正した．
大きな変更が以下の2点
- ユーザーとタグが多対多の場合の、タグを新規作成したときの処理の流れ
- エントリーシートを新規作成するときの流れ(企業テーブルと企業URLテーブルが分離したことによってどうなるのか)
## ユーザーとタグが多対多の場合、タグを作成したときの処理の流れ
### シチュエーション
- ユーザーを追加するときには，そのユーザーはタグをもっていないから特に気にすることはない(できれば新規ユーザーにも幾つかデフォルトのタグを与えたい)
- 各ユーザーは必要に応じて自分でタグを作成する．

### 処理フロー
1. ユーザーがタグを作成
1. タグテーブルにそのタグがすでにあるときはそのレコードを取得，ないときはレコードを新規作成
1. ユーザーとタグの中間テーブルにレコードを新規作成

## 新しくエントリーシートを追加するときはどうしたらいいのか
### シチュエーション
- ユーザーはエントリーシートを新規作成
- エントリーシートの内容(抜粋, ES情報登録の画像参照)
    * 企業名
    * 採用ページURL
    * 質問(複数)

### 処理フロー
1. 企業テーブルにおいて企業名でレコードを検索．ない場合は新規作成
1. 企業URLテーブルにおいて3.で取得した企業ID(PK)と企業URLでレコードを検索．ない場合は新規作成．
1. エントリーシートテーブルにエントリーシートそのものを作成
1. 5.で作成したエントリーシートのレコードに紐付けて，質問を質問テーブルに保存

 ![エントリーシート新規作成](es_registry.png "エントリーシート登録画面")

 # 不具合
- 異なる企業で同一のURLを使用すると編集画面に遷移するときにエラー
    * 一つのURLに対して紐づく企業は1社なので，2社目以降はURLがないことになる．

- herokuでメモリ(ROM)が足りない
```bash
Process running mem=802M(156.8%)
```
